# üß™ Guide de Test - Statistiques des Questions

## Installation et premier test

### 1. Installation du plugin

```bash
# Se placer dans le dossier Moodle
cd /path/to/moodle

# Copier les fichiers du plugin
cp -r moodle_dev-questions local/question_diagnostic

# V√©rifier les permissions
chmod -R 755 local/question_diagnostic
chmod -R 644 local/question_diagnostic/*.php
```

### 2. Activation dans Moodle

1. Connectez-vous en tant qu'administrateur
2. Allez dans **Administration du site > Notifications**
3. Le plugin devrait appara√Ætre pour installation
4. Cliquez sur **Mettre √† jour la base de donn√©es Moodle**
5. Confirmez l'installation

### 3. Premier acc√®s

**M√©thode 1 - Via le menu :**
1. Administration du site
2. Local plugins
3. Question Diagnostic
4. Cliquer sur "Analyser les questions ‚Üí"

**M√©thode 2 - URL directe :**
```
https://votre-moodle.com/local/question_diagnostic/questions_cleanup.php
```

---

## ‚úÖ Checklist de test

### Tests basiques (5 min)

- [ ] **Acc√®s √† la page**
  - La page se charge sans erreur
  - Le dashboard s'affiche avec 6 cartes
  - Les statistiques sont coh√©rentes

- [ ] **Dashboard**
  - Carte "Total Questions" affiche un nombre > 0
  - Carte "Questions Utilis√©es" ‚â§ Total
  - Carte "Questions Inutilis√©es" = Total - Utilis√©es
  - Carte "Questions en Doublon" ‚â• 0
  - Carte "Questions Cach√©es" ‚â• 0
  - Carte "Liens Cass√©s" ‚â• 0

- [ ] **R√©partition par type**
  - Tous les types pr√©sents sont affich√©s
  - Les pourcentages totalisent ~100%
  - Clic sur un type fonctionne (si impl√©ment√©)

### Tests des filtres (10 min)

#### Test 1 : Recherche
```
Action : Taper "test" dans la barre de recherche
R√©sultat attendu : 
- Seules les questions contenant "test" dans leur nom, ID ou texte s'affichent
- Le compteur se met √† jour
- Le filtrage se fait en temps r√©el (< 1s)
```

#### Test 2 : Filtre par type
```
Action : S√©lectionner "multichoice" dans le filtre Type
R√©sultat attendu :
- Seules les questions de type multichoice s'affichent
- Le compteur affiche le bon nombre
- Les autres lignes sont masqu√©es (display: none)
```

#### Test 3 : Filtre par usage
```
Action : S√©lectionner "Inutilis√©es"
R√©sultat attendu :
- Seules les questions avec Quiz=0 ET Tentatives=0 s'affichent
- Le nombre correspond √† la carte "Questions Inutilis√©es"
```

#### Test 4 : Filtre par doublons
```
Action : S√©lectionner "Avec doublons"
R√©sultat attendu :
- Seules les questions avec Doublons > 0 s'affichent
- Les badges "Doublons: X" sont visibles et cliquables
```

#### Test 5 : Filtres combin√©s
```
Action : 
1. Recherche: "question"
2. Type: "multichoice"
3. Usage: "Utilis√©es"

R√©sultat attendu :
- Les 3 filtres s'appliquent simultan√©ment (AND)
- Le compteur refl√®te le r√©sultat final
```

### Tests du tableau (10 min)

#### Test 6 : Tri des colonnes
```
Action : Cliquer sur l'en-t√™te "ID"
R√©sultat attendu :
- Premi√®re fois : tri croissant (1, 2, 3...)
- Indicateur ‚ñ≤ appara√Æt
- Deuxi√®me fois : tri d√©croissant (3, 2, 1...)
- Indicateur ‚ñº appara√Æt
```

R√©p√©ter pour :
- [ ] Colonne "Nom" (alphab√©tique)
- [ ] Colonne "Type" (alphab√©tique)
- [ ] Colonne "Quiz" (num√©rique)
- [ ] Colonne "Doublons" (num√©rique)

#### Test 7 : Gestion des colonnes
```
Action : Cliquer sur le bouton "‚öôÔ∏è Colonnes"
R√©sultat attendu :
- Un panneau s'ouvre avec toutes les colonnes
- Les colonnes actuellement affich√©es sont coch√©es
- D√©cocher "ID" ‚Üí la colonne dispara√Æt du tableau
- Recharger la page ‚Üí la pr√©f√©rence est conserv√©e (localStorage)
```

#### Test 8 : Liens vers la banque
```
Action : Cliquer sur "üëÅÔ∏è Voir" pour une question
R√©sultat attendu :
- Nouvel onglet s'ouvre
- URL : /question/edit.php?courseid=X&cat=Y,Z&qid=Q
- La question est pr√©s√©lectionn√©e dans la banque
```

### Tests des doublons (15 min)

#### Test 9 : Modal des doublons
```
Action : Cliquer sur un badge "Doublons: 2"
R√©sultat attendu :
- Un modal s'ouvre
- Titre : "Questions en doublon"
- Affiche le nom de la question source
- Liste les 2 doublons avec :
  - ID
  - Nom
  - Type
  - Cat√©gorie
  - Bouton "Voir"
```

#### Test 10 : V√©rification de la similarit√©

**Cr√©er 2 questions similaires :**
1. Cr√©er une question "Test de math√©matiques"
2. Dupliquer et renommer en "Test de math√©matique" (sans s)
3. Recharger la page de statistiques

```
R√©sultat attendu :
- Les 2 questions apparaissent avec "Doublons: 1"
- Le score de similarit√© devrait √™tre > 85%
- Le modal affiche bien les 2 questions li√©es
```

### Tests de l'export (5 min)

#### Test 11 : Export CSV
```
Action : Cliquer sur "üì• Exporter en CSV"
R√©sultat attendu :
- Un fichier CSV est t√©l√©charg√©
- Nom : questions_statistics_YYYY-MM-DD_HH-mm-ss.csv
- Ouvrir dans Excel :
  - 13 colonnes
  - Encodage UTF-8 correct (accents affich√©s)
  - Toutes les lignes pr√©sentes
  - Virgules comme s√©parateurs
```

### Tests de performance (5 min)

#### Test 12 : Temps de chargement

**Si < 100 questions :**
```
R√©sultat attendu : < 2 secondes
```

**Si 100-500 questions :**
```
R√©sultat attendu : < 5 secondes
```

**Si > 1000 questions :**
```
R√©sultat attendu : < 30 secondes
Action si d√©pass√© :
- V√©rifier la configuration PHP (memory_limit, max_execution_time)
- Consulter les logs Moodle
```

#### Test 13 : R√©activit√© des filtres
```
Action : Taper rapidement plusieurs lettres dans la recherche
R√©sultat attendu :
- Pas de lag
- Debounce de 300ms fonctionne
- R√©sultats se mettent √† jour apr√®s la pause
```

### Tests de s√©curit√© (5 min)

#### Test 14 : Contr√¥le d'acc√®s
```
Action : Se connecter en tant qu'enseignant (non-admin)
Tenter d'acc√©der √† questions_cleanup.php

R√©sultat attendu :
- Message d'erreur : "Acc√®s refus√©"
- Pas d'affichage de donn√©es sensibles
```

#### Test 15 : Protection CSRF
```
Action : 
1. Ouvrir l'inspecteur du navigateur
2. R√©seau > Filtrer par XHR
3. Cliquer sur "Exporter en CSV"
4. Observer la requ√™te

R√©sultat attendu :
- Param√®tre "sesskey" pr√©sent dans l'URL
- Valeur = token de session actuel
```

---

## üêõ R√©solution de probl√®mes

### Probl√®me 1 : Page blanche

**Sympt√¥me :** Page blanche, rien ne s'affiche

**Diagnostic :**
```bash
# V√©rifier les logs PHP
tail -f /var/log/apache2/error.log

# Ou dans Moodle
# Administration du site > Rapports > Journaux
```

**Solutions possibles :**
1. Erreur de syntaxe PHP ‚Üí V√©rifier les fichiers
2. M√©moire insuffisante ‚Üí Augmenter `memory_limit` √† 512M
3. Timeout ‚Üí Augmenter `max_execution_time` √† 120s

### Probl√®me 2 : Statistiques incoh√©rentes

**Sympt√¥me :** Nombres aberrants dans le dashboard

**Diagnostic :**
```sql
-- V√©rifier le nombre de questions
SELECT COUNT(*) FROM mdl_question;

-- V√©rifier les quiz
SELECT COUNT(DISTINCT questionid) FROM mdl_quiz_slots;

-- V√©rifier les tentatives
SELECT COUNT(DISTINCT questionid) FROM mdl_question_attempts;
```

**Solutions possibles :**
1. Cache Moodle ‚Üí Purger les caches
2. Base corrompue ‚Üí V√©rifier l'int√©grit√© des tables
3. Plugin non √† jour ‚Üí R√©installer

### Probl√®me 3 : Doublons non d√©tect√©s

**Sympt√¥me :** Questions similaires non d√©tect√©es comme doublons

**Diagnostic :**
```php
// Dans classes/question_analyzer.php, ligne ~158
// Temporairement r√©duire le seuil
$duplicates = self::find_question_duplicates($question, 0.75); // au lieu de 0.85
```

**Solutions possibles :**
1. Seuil trop √©lev√© ‚Üí R√©duire √† 0.75 ou 0.70
2. Textes trop diff√©rents ‚Üí V√©rifier l'algorithme de similarit√©
3. Questions dans cat√©gories diff√©rentes ‚Üí Augmenter le poids du texte

### Probl√®me 4 : Export CSV vide

**Sympt√¥me :** Fichier CSV t√©l√©charg√© mais vide

**Diagnostic :**
```php
// Dans actions/export.php
// Ajouter avant l'export :
error_log("Nombre de questions √† exporter : " . count($questions));
```

**Solutions possibles :**
1. Timeout ‚Üí Augmenter `max_execution_time`
2. M√©moire ‚Üí Augmenter `memory_limit`
3. Caract√®res sp√©ciaux ‚Üí V√©rifier l'encodage UTF-8

### Probl√®me 5 : Colonnes ne se masquent pas

**Sympt√¥me :** Cocher/d√©cocher les colonnes ne fait rien

**Diagnostic :**
```javascript
// Ouvrir la console du navigateur (F12)
// V√©rifier les erreurs JavaScript
console.log(localStorage.getItem('qd_column_prefs'));
```

**Solutions possibles :**
1. JavaScript d√©sactiv√© ‚Üí Activer JavaScript
2. localStorage bloqu√© ‚Üí V√©rifier les cookies/stockage
3. Erreur JS ‚Üí Consulter la console

---

## üìä Sc√©narios de test complets

### Sc√©nario 1 : Nettoyage de printemps

**Contexte :** Fin d'ann√©e scolaire, besoin de nettoyer la base

**√âtapes :**
1. ‚úÖ Acc√©der √† la page de statistiques
2. ‚úÖ Noter le nombre total de questions
3. ‚úÖ Filtrer par "Inutilis√©es"
4. ‚úÖ Trier par "Date cr√©ation" (plus anciennes en premier)
5. ‚úÖ Pour chaque question > 1 an et inutilis√©e :
   - Cliquer sur "Voir"
   - V√©rifier le contenu
   - D√©cider : garder ou supprimer
6. ‚úÖ Exporter la liste des questions supprim√©es (CSV)
7. ‚úÖ Supprimer manuellement via la banque
8. ‚úÖ Revenir sur la page ‚Üí V√©rifier nouveau total

**Temps estim√© :** 30-60 minutes

### Sc√©nario 2 : Chasse aux doublons

**Contexte :** Plusieurs enseignants cr√©ent des questions similaires

**√âtapes :**
1. ‚úÖ Filtrer par "Avec doublons"
2. ‚úÖ Trier par "Doublons" (d√©croissant)
3. ‚úÖ Pour chaque groupe de doublons :
   - Cliquer sur le badge
   - Comparer les questions dans le modal
   - Noter la plus utilis√©e (colonne Quiz)
   - Ouvrir toutes les versions dans des onglets
   - Choisir la meilleure version
   - Supprimer les autres
4. ‚úÖ Recharger ‚Üí V√©rifier la r√©duction des doublons

**Temps estim√© :** 1-2 heures

### Sc√©nario 3 : Audit pour migration

**Contexte :** Migration vers un nouveau Moodle

**√âtapes :**
1. ‚úÖ Afficher toutes les colonnes (surtout Contexte, Cr√©ateur, Dates)
2. ‚úÖ Exporter en CSV
3. ‚úÖ Ouvrir dans Excel
4. ‚úÖ Cr√©er un tableau crois√© dynamique :
   - Lignes : Type de question
   - Valeurs : Nombre de questions
5. ‚úÖ Identifier les types peu utilis√©s
6. ‚úÖ Revenir sur Moodle
7. ‚úÖ Filtrer par ces types
8. ‚úÖ D√©cider : migrer ou archiver

**Temps estim√© :** 2-3 heures

---

## üéØ Tests de validation finale

### Checklist de recette

Avant de valider l'impl√©mentation, v√©rifier :

#### Fonctionnel
- [ ] Dashboard affiche 6 cartes avec valeurs correctes
- [ ] R√©partition par type affiche tous les types
- [ ] 4 filtres fonctionnent (recherche, type, usage, doublons)
- [ ] Filtres combinables (AND)
- [ ] Tri des colonnes (croissant/d√©croissant)
- [ ] 14 colonnes configurables
- [ ] Pr√©f√©rences colonnes sauvegard√©es
- [ ] Modal des doublons s'ouvre et affiche les donn√©es
- [ ] Export CSV t√©l√©chargeable et lisible
- [ ] Liens vers banque de questions fonctionnent

#### Performance
- [ ] Chargement < 30s (pour bases < 5000 questions)
- [ ] Filtrage instantan√© (< 500ms)
- [ ] Tri instantan√© (< 500ms)
- [ ] Export CSV < 10s

#### S√©curit√©
- [ ] Acc√®s r√©serv√© aux admins
- [ ] Protection CSRF sur l'export
- [ ] Aucune injection SQL possible
- [ ] Aucun XSS possible

#### UX/UI
- [ ] Design coh√©rent avec le reste du plugin
- [ ] Responsive (mobile, tablette, desktop)
- [ ] Pas d'erreur dans la console
- [ ] Messages d'information clairs
- [ ] Pas de texte en dur (tout traduit)

#### Documentation
- [ ] FEATURE_QUESTIONS_STATS.md complet
- [ ] FEATURE_IMPLEMENTATION_SUMMARY.md complet
- [ ] TESTING_GUIDE.md (ce fichier) complet
- [ ] Code comment√© en fran√ßais

---

## üìù Rapport de test (template)

```markdown
# Rapport de test - Statistiques des Questions
Date : [DATE]
Testeur : [NOM]
Environnement : [Moodle X.X, PHP X.X, MySQL X.X]

## R√©sum√©
- Tests r√©ussis : X/40
- Tests √©chou√©s : X/40
- Bloquants : X

## D√©tails

### Dashboard
- ‚úÖ Affichage correct
- ‚ùå Erreur sur carte X : [description]

### Filtres
- ‚úÖ Recherche
- ‚úÖ Type
- ‚ö†Ô∏è Usage : lenteur constat√©e
- ‚úÖ Doublons

### Tableau
- ‚úÖ Tri
- ‚úÖ Colonnes
- ‚úÖ Liens

### Export
- ‚úÖ CSV t√©l√©charg√©
- ‚ùå Encodage incorrect

### Performance
- Temps de chargement : Xs
- Nombre de questions : X
- ‚úÖ / ‚ùå Acceptable

## Bugs identifi√©s
1. [Bug 1] : [Description]
2. [Bug 2] : [Description]

## Recommandations
- [Recommandation 1]
- [Recommandation 2]

## Validation finale
- ‚úÖ / ‚ùå Pr√™t pour la production
```

---

## üÜò Support

En cas de probl√®me lors des tests :

1. **Consulter les logs Moodle**
   ```
   Administration du site > Rapports > Journaux
   ```

2. **Activer le mode debug**
   ```php
   // Dans config.php
   $CFG->debug = 32767;
   $CFG->debugdisplay = 1;
   ```

3. **V√©rifier la configuration PHP**
   ```bash
   php -i | grep -E "memory_limit|max_execution_time"
   ```

4. **Purger tous les caches**
   ```
   Administration du site > D√©veloppement > Purger tous les caches
   ```

---

**Bon courage pour les tests ! üöÄ**

*Guide cr√©√© : Octobre 2025*
*Version : 1.0*

