<?xml version="1.0" encoding="UTF-8"?>
<phpunit xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="https://schema.phpunit.de/9.5/phpunit.xsd"
         bootstrap="vendor/autoload.php"
         colors="true"
         beStrictAboutTestsThatDoNotTestAnything="false"
         beStrictAboutOutputDuringTests="false"
         beStrictAboutTodoAnnotatedTests="false"
         failOnRisky="false"
         failOnWarning="false"
         verbose="true"
         convertErrorsToExceptions="true"
         convertNoticesToExceptions="true"
         convertWarningsToExceptions="true"
         processIsolation="false"
         stopOnFailure="false"
         syntaxCheck="false">

    <testsuites>
        <testsuite name="local_question_diagnostic">
            <directory suffix="_test.php">./tests</directory>
            <directory suffix="test.php">./tests</directory>
        </testsuite>
    </testsuites>

    <filter>
        <whitelist processUncoveredFilesFromWhitelist="true">
            <directory suffix=".php">./</directory>
            <exclude>
                <directory>./tests</directory>
                <directory>./vendor</directory>
                <directory>./node_modules</directory>
                <directory>./docs</directory>
                <file>./phpunit.xml</file>
                <file>./composer.json</file>
                <file>./composer.lock</file>
            </exclude>
        </whitelist>
    </filter>

    <logging>
        <log type="coverage-html" target="tests/coverage/html"/>
        <log type="coverage-clover" target="tests/coverage/clover.xml"/>
        <log type="junit" target="tests/coverage/junit.xml"/>
    </logging>

    <php>
        <!-- Configuration Moodle -->
        <const name="MOODLE_INTERNAL" value="true"/>
        <const name="CLI_SCRIPT" value="true"/>
        <const name="ABORT_AFTER_CONFIG" value="10"/>
        
        <!-- Variables d'environnement pour les tests -->
        <env name="MOODLE_TEST_DB" value="moodle_test"/>
        <env name="MOODLE_TEST_DBHOST" value="localhost"/>
        <env name="MOODLE_TEST_DBUSER" value="root"/>
        <env name="MOODLE_TEST_DBPASS" value=""/>
        <env name="MOODLE_TEST_DBPREFIX" value="mdl_"/>
        
        <!-- Configuration PHP pour les tests -->
        <ini name="memory_limit" value="256M"/>
        <ini name="max_execution_time" value="300"/>
        <ini name="error_reporting" value="E_ALL"/>
        <ini name="display_errors" value="1"/>
        <ini name="log_errors" value="1"/>
    </php>

    <listeners>
        <listener class="PHPUnit\Framework\TestListener" file="vendor/phpunit/phpunit/src/Framework/TestListener.php"/>
    </listeners>

</phpunit>
